# contains proper common name of metabolites along with their different ids
# This needs to be done manually
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
metadata <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::left_join(name_mapping, by = c("ID" = "PubChem"))
View(metadata)
metadata <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "PubChem"))
metadata <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "PubChem")) %>%
dplyr::rename(PubChem = ID)
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(name_mapping, by = c("ID" = "PubChem")) %>%
dplyr::rename(PubChem = ID)
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(name_mapping, by = c("ID" = "PubChem")) %>%
dplyr::rename(PubChem = ID) %>%
dplyr::left_join(name_mapping, by = c("ID" = "KEGG"))
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(name_mapping, by = c("ID" = "PubChem")) %>%
dplyr::left_join(name_mapping, by = c("ID" = "KEGG"))
View(metadata1)
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem"))
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem")) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "KEGG"))
View(metadata1)
metadata <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "PubChem")) %>%
dplyr::rename(PubChem = ID)
metadata1 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem")) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "KEGG")) %>%
dplyr::rename(KEGG = ID)
metadata2 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem")) %>%
dplyr::anti_join(metadata1, by = c("ID" = "KEGG")) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "HMDB")) %>%
dplyr::rename(HMDB = ID)
View(metadata2)
metadata3 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem")) %>%
dplyr::anti_join(metadata1, by = c("ID" = "KEGG")) %>%
dplyr::anti_join(metadata2, by = c("ID" = "HMDB")) %>%
dplyr::inner_join(name_mapping, by = c("ID" = "ChEBI")) %>%
dplyr::rename(ChEBI = ID)
metadata3 <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::anti_join(metadata, by = c("ID" = "PubChem")) %>%
dplyr::anti_join(metadata1, by = c("ID" = "KEGG")) %>%
dplyr::anti_join(metadata2, by = c("ID" = "HMDB"))
View(metadata3)
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
tidyr::pivot_longer(cols = -CommonName,     # adjust if your name column differs
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
all(full_metabolites$Query == full_metabolites$KEGG)
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, Comment)
tidyr::pivot_longer(cols = Match,
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, Comment)
tidyr::pivot_longer(cols = "Match",
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, Comment)
tidyr::pivot_longer(cols = c("Match"),
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, -Comment)
tidyr::pivot_longer(cols = c("Match"),
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, -Comment)
tidyr::pivot_longer(cols = !"Match",
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, -Comment)
tidyr::pivot_longer(cols = !Match,
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, -Comment)
tidyr::pivot_longer(cols = !Match,
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character)) %>%
dplyr::select(-Query, -Comment) %>%
tidyr::pivot_longer(cols = !Match,
names_to = "ID_type",
values_to = "ID") %>%
dplyr::filter(!is.na(ID))
metadata <- full_metabolites %>%
dplyr::select(compound, ID, Pathway) %>%
dplyr::left_join(name_mapping, by = "ID")
View(metadata)
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
full_metabolites <- data1[,c(1:8)] %>%
dplyr::bind_rows(data2[,c(1:8)]) %>%
dplyr::bind_rows(data3[,c(1:3)]) %>%
dplyr::filter(!is.na(compound)) %>%
dplyr::mutate(ID = dplyr::case_when(!is.na(PubChem) ~ as.character(PubChem),
!is.na(HMDB) ~ as.character(HMDB),
!is.na(KEGG) ~ as.character(KEGG),
!is.na(ChEBI) ~ as.character(ChEBI),
!is.na(METLIN) ~ as.character(METLIN),
TRUE ~ as.character(CmpdID))) %>%
dplyr::distinct_at("CmpdID", .keep_all = TRUE)
metadata <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c(
"PubChem" = "PubChem",
"KEGG"    = "KEGG",
"HMDB"    = "HMDB",
"ChEBI"   = "ChEBI",
"METLIN"  = "METLIN"
)
)
View(metadata)
full_metabolites <- data1[,c(1:8)] %>%
dplyr::bind_rows(data2[,c(1:8)]) %>%
dplyr::bind_rows(data3[,c(1:3)]) %>%
dplyr::filter(!is.na(compound)) %>%
# dplyr::mutate(ID = dplyr::case_when(!is.na(PubChem) ~ as.character(PubChem),
#                                     !is.na(HMDB) ~ as.character(HMDB),
#                                     !is.na(KEGG) ~ as.character(KEGG),
#                                     !is.na(ChEBI) ~ as.character(ChEBI),
#                                     !is.na(METLIN) ~ as.character(METLIN),
#                                     TRUE ~ as.character(CmpdID))) %>%
dplyr::distinct_at("CmpdID", .keep_all = TRUE)
metadata <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c(
"PubChem" = "PubChem",
"KEGG"    = "KEGG",
"HMDB"    = "HMDB",
"ChEBI"   = "ChEBI",
"METLIN"  = "METLIN"
)
)
metadata <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c(
"PubChem" = "PubChem",
"KEGG"    = "KEGG",
"HMDB"    = "HMDB",
"ChEBI"   = "ChEBI",
"METLIN"  = "METLIN",
"CmpdID"  = "KEGG"
)
)
metadata <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c("PubChem" = "PubChem",
"KEGG"    = "KEGG",
"HMDB"    = "HMDB",
"ChEBI"   = "ChEBI",
"METLIN"  = "METLIN",
"CmpdID"  = "KEGG"))
metadata <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c("PubChem" = "PubChem",
"KEGG"    = "KEGG",
"HMDB"    = "HMDB",
"ChEBI"   = "ChEBI",
"METLIN"  = "METLIN"))
View(metadata)
metadata1 <- full_metabolites %>%
dplyr::left_join(
name_mapping,
by = c("CmpdID" = "Query"))
View(metadata1)
metadata1 <- full_metabolites %>%
dplyr::select(compound, Query, Pathway) %>%
dplyr::left_join(
name_mapping,
by = c("CmpdID" = "Query"))
metadata1 <- full_metabolites %>%
dplyr::select(compound, CmpdID, Pathway) %>%
dplyr::left_join(
name_mapping,
by = c("CmpdID" = "Query"))
View(metadata1)
View(metadata1)
data_path <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Boopati"
# Combine metabolite data from all assays and get proper metabolite names from Metaboanalyst
data1 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49_Yneg_vs_Ypos_Repeat1.xlsx"))
data2 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49Yneg_DDR2KO_vs_SCR_Repeat1.xlsx"))
data3 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49Yneg_DDR2KO_vs_SCR_Repeat2.xlsx"),
sheet="Global metabolomics")
data1 <- data1[,c(2:9,13:21)]
data2 <- data2[,c(2:9,13:18)]
data3 <- data3[,c(2:4,8:13)]
colnames(data1) <- data1[2,]
colnames(data2) <- data2[1,]
colnames(data3)[1:3] <- data3[2,c(1:3)]
data1 <- data1[-c(1:2),]
data2 <- data2[-1,]
data3 <- data3[-c(1:2),]
colnames(data1)[9:17] <- c("MB49_Parental1", "MB49_Parental2", "MB49_Parental3",
"MB49_Ypos1",  "MB49_Ypos2", "MB49_Ypos3",
"MB49_Yneg1", "MB49_Yneg2", "MB49_Yneg3")
colnames(data2)[9:14] <- c("MB49_Yneg_scr1",  "MB49_Yneg_scr2", "MB49_Yneg_scr3",
"MB49_Yneg_DDR2KO1", "MB49_Yneg_DDR2KO2", "MB49_Yneg_DDR2KO3")
colnames(data3)[4:9] <- c("MB49_Yneg_scr1",  "MB49_Yneg_scr2", "MB49_Yneg_scr3",
"MB49_Yneg_DDR2KO1", "MB49_Yneg_DDR2KO2", "MB49_Yneg_DDR2KO3")
full_metabolites <- data1[,c(1:8)] %>%
dplyr::bind_rows(data2[,c(1:8)]) %>%
dplyr::bind_rows(data3[,c(1:3)]) %>%
dplyr::filter(!is.na(compound)) %>%
dplyr::distinct_at("CmpdID", .keep_all = TRUE)
# Using HMDBID, KEGGID, etc from above xlsx file, create a new file that
# contains proper common name of metabolites along with their different ids
# This needs to be done manually
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
full_metabolites1 <- full_metabolites %>%
dplyr::select(compound, CmpdID, Pathway) %>%
dplyr::left_join(
name_mapping,
by = c("CmpdID" = "Query"))
View(full_metabolites)
View(full_metabolites1)
proper_metabolites <- full_metabolites %>%
dplyr::select(compound, CmpdID, Pathway) %>%
dplyr::left_join(name_mapping, by = c("CmpdID" = "Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::select(Initial_compound, Compound, PubChem, HMDB, KEGG, ChEBI, METLIN, Pathway)
View(proper_metabolites)
metadata <- dplyr::bind_rows(name_mapping1, name_mapping2, name_mapping3) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::select(Initial_compound, Compound, PubChem, HMDB, KEGG, ChEBI, METLIN, Pathway)
View(metadata)
sapply(metadata, class)
sapply(proper_metabolites, class)
all.equal(metadata, proper_metabolites)
all.equal(metadata %>% arrange(Initial_compound), proper_metabolites %>% arrange(Initial_compound))
all.equal(metadata %>% arrange(Initial_compound), proper_metabolites %>% arrange(Initial_compound), check.attributes = F)
all.equal(metadata %>% arrange(Initial_compound), proper_metabolites %>% arrange(Initial_compound), check.attributes = FALSE)
all.equal(metadata %>% arrange(Initial_compound), proper_metabolites %>% arrange(Initial_compound), check.attributes = FALSE)
View(data1)
replace_metabolites <- function(df, metadata) {
df %>%
select(-any_of(c("CmpdID", "PubChem", "HMDB", "KEGG", "ChEBI", "METLIN", "Pathway"))) %>%
left_join(metadata, by = c("compound" = "Initial_compound")) %>%
select(Compound, everything(), -compound)
}
data1 <- replace_metabolites(data1, proper_metabolites)
data2 <- replace_metabolites(data2, proper_metabolites)
data3 <- replace_metabolites(data3, proper_metabolites)
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame()
View(ccle)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(paste0(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
View(name_mapping)
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("CmpdID")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("CmpdID"="Query"))
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
View(name_mapping)
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query"))
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::mutate(Compound = dplyr::case_when(is.na(Compound) ~ Initial_compound,
TRUE ~ Compound))
View(data1)
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::mutate(Compound = dplyr::case_when(is.na(Compound) ~ Initial_compound,
TRUE ~ Compound)) %>%
dplyr::select(Compound, everything(), -c(SMILES, Comment))
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::mutate(Compound = dplyr::case_when(is.na(Compound) ~ Initial_compound,
TRUE ~ Compound)) %>%
dplyr::select(Compound, everything(), -c(SMILES, Comment))
View(ccle)
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::mutate(Compound = dplyr::case_when(is.na(Compound) ~ Initial_compound,
TRUE ~ Compound)) %>%
dplyr::select(Compound, everything(), -c(SMILES, Comment, Initial_compound))
data_path <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Boopati"
# Combine metabolite data from all assays and get proper metabolite names from Metaboanalyst
data1 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49_Yneg_vs_Ypos_Repeat1.xlsx"))
data2 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49Yneg_DDR2KO_vs_SCR_Repeat1.xlsx"))
data3 <- read.xlsx(file.path(data_path, "Data_metabolomics_MB49Yneg_DDR2KO_vs_SCR_Repeat2.xlsx"),
sheet="Global metabolomics")
data1 <- data1[,c(2:9,13:21)]
data2 <- data2[,c(2:9,13:18)]
data3 <- data3[,c(2:4,8:13)]
colnames(data1) <- data1[2,]
colnames(data2) <- data2[1,]
colnames(data3)[1:3] <- data3[2,c(1:3)]
data1 <- data1[-c(1:2),]
data2 <- data2[-1,]
data3 <- data3[-c(1:2),]
colnames(data1)[9:17] <- c("MB49_Parental1", "MB49_Parental2", "MB49_Parental3",
"MB49_Ypos1",  "MB49_Ypos2", "MB49_Ypos3",
"MB49_Yneg1", "MB49_Yneg2", "MB49_Yneg3")
colnames(data2)[9:14] <- c("MB49_Yneg_scr1",  "MB49_Yneg_scr2", "MB49_Yneg_scr3",
"MB49_Yneg_DDR2KO1", "MB49_Yneg_DDR2KO2", "MB49_Yneg_DDR2KO3")
colnames(data3)[4:9] <- c("MB49_Yneg_scr1",  "MB49_Yneg_scr2", "MB49_Yneg_scr3",
"MB49_Yneg_DDR2KO1", "MB49_Yneg_DDR2KO2", "MB49_Yneg_DDR2KO3")
# Merge metabolites from all datasets
full_metabolites <- data1[,c(1:8)] %>%
dplyr::bind_rows(data2[,c(1:8)]) %>%
dplyr::bind_rows(data3[,c(1:3)]) %>%
dplyr::filter(!is.na(compound)) %>%
dplyr::distinct_at("CmpdID", .keep_all = TRUE)
# Using HMDBID, KEGGID, etc from above xlsx file, create a new file that
# contains proper common name of metabolites along with their different ids
# This needs to be done manually. Once completed, import it.
name_mapping <- read.xlsx(file.path(data_path, "Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Fix full_metabolites which has improper metabolite names with proper names
proper_metabolites <- full_metabolites %>%
dplyr::select(compound, CmpdID, Pathway) %>%
dplyr::left_join(name_mapping, by = c("CmpdID" = "Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::select(Initial_compound, Compound, PubChem, HMDB, KEGG, ChEBI, METLIN, Pathway)
# Replace original data with proper metabolite info
replace_metabolites <- function(df, metadata) {
df %>%
select(-any_of(c("CmpdID", "PubChem", "HMDB", "KEGG", "ChEBI", "METLIN", "Pathway"))) %>%
left_join(metadata, by = c("compound" = "Initial_compound")) %>%
select(Compound, everything(), -compound)
}
data1 <- replace_metabolites(data1, proper_metabolites)
data2 <- replace_metabolites(data2, proper_metabolites)
data3 <- replace_metabolites(data3, proper_metabolites)
# Get metabolite data for CCLE
ccle <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(colnames(.)[!grepl("lineage|cell_line", colnames(.))]) %>%
tibble::column_to_rownames("depmap_id") %>%
t() %>%
data.frame() %>%
tibble::rownames_to_column("compound")
# Get cell line info for CCLE
cell_lines <- readr::read_csv(file.path(data_path, "Metabolomics_subsetted.csv"), show_col_types = FALSE) %>%
dplyr::select(depmap_id, cell_line_display_name)
# Get proper metabolite names from metaboanalyst
name_mapping  <- read.xlsx(file.path(data_path, "CCLE_Metaboanalyst_name_map.xlsx")) %>%
dplyr::mutate(across(.cols = everything(), .fns = as.character))
# Replace metabolite names in CCLE with proper names from metaboanalyst
ccle <- ccle %>%
dplyr::left_join(name_mapping, by=c("compound"="Query")) %>%
dplyr::rename(Initial_compound = compound, Compound = Match) %>%
dplyr::mutate(Compound = dplyr::case_when(is.na(Compound) ~ Initial_compound,
TRUE ~ Compound)) %>%
dplyr::select(Compound, everything(), -c(SMILES, Comment, Initial_compound))
# Save the metabolites with proper name and ids
wb <- openxlsx::createWorkbook()
# openxlsx::addWorksheet(wb, sheetName = "Metabolites")
# openxlsx::writeData(wb, sheet = "Metabolites", x = metadata, rowNames = FALSE)
openxlsx::addWorksheet(wb, sheetName = "MB49_Yneg_vs_Ypos_Repeat1")
openxlsx::writeData(wb, sheet = "MB49_Yneg_vs_Ypos_Repeat1", x = data1, rowNames = FALSE)
openxlsx::addWorksheet(wb, sheetName = "MB49Yneg_DDR2KO_vs_SCR_Repeat1")
openxlsx::writeData(wb, sheet = "MB49Yneg_DDR2KO_vs_SCR_Repeat1", x = data2, rowNames = FALSE)
openxlsx::addWorksheet(wb, sheetName = "MB49Yneg_DDR2KO_vs_SCR_Repeat2")
openxlsx::writeData(wb, sheet = "MB49Yneg_DDR2KO_vs_SCR_Repeat2", x = data3, rowNames = FALSE)
openxlsx::addWorksheet(wb, sheetName = "CCLE")
openxlsx::writeData(wb, sheet = "CCLE", x = ccle, rowNames = FALSE)
openxlsx::addWorksheet(wb, sheetName = "CCLE_CellLines")
openxlsx::writeData(wb, sheet = "CCLE_CellLines", x = cell_lines, rowNames = FALSE)
openxlsx::saveWorkbook(wb = wb,
file = paste0(data_path, "Metabolites_complete.xlsx"),
overwrite = TRUE)
# Get CCLE data with correct metabolite names
ccle <- read.xlsx(file.path(data_path, "Metabolites_complete.xlsx"),
sheet="CCLE") %>%
dplyr::select(everything(), -c(PubChem, HMDB, KEGG, ChEBI, METLIN))
y <- read.xlsx(file.path(data_path, "Metabolites_complete.xlsx"),
sheet="MB49_Yneg_vs_Ypos_Repeat1") %>%
dplyr::select(everything(), -c(PubChem, HMDB, KEGG, ChEBI, METLIN, Pathway))
# Remove parental lines
y <- y [,-c(2:4)]
