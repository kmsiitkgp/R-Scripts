device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
}
rlang::last_trace()
bar_plots <- cowplot::plot_grid(plotlist = bar_plots, ncol = 3, nrow = 2)
dot_plots <- cowplot::plot_grid(plotlist = dot_plot_list, ncol = 3, nrow = 2)
data <- read.xlsx("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Saswat/Saswat_Pathways.xlsx")
save.dir <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/"
dot_plot_list <- list()
bar_plots <- list()
for (g in unique(data$Genes)){
df <- data %>%
dplyr::filter(Genes == g) %>%
dplyr::filter(P.value <= 0.05)
plot_colors <- c("Upregulated" = "#E69F00", "Downregulated" = "#56B4E9")
# str_wrap() wraps only between words, and it defines "words" based on spaces (" ").
# If all words are connected by "_", it wont split.
df <- df %>%
dplyr::mutate(Description = gsub(pattern = "_", replacement = " ", x = Description),
Description = stringr::str_wrap(string = Description, width = 30))
# Decide if there are multiple collections or single collection.
# If multiple, plot each collection separately,
collections <- "Reactome"
n_collections <- length(collections)
for (i in seq_len(n_collections)){
plot_df <- df %>% dplyr::filter(Collection %in% collections[i])
# Choose x axis column, size column and labels
x_col <- sym("Combined.Score")
x_label <- "Combined.Score"
size_col <- sym("P.value")
color_col <- sym("P.value")
score_var <- "Combined.Score"
x_limits <- c(0, NA)  # start at 0, auto end
df <- df %>%
dplyr::filter(!is.na(.data[[score_var]])) %>%
dplyr::arrange(dplyr::desc(.data[[score_var]]))
# Pad with empty rows if fewer than 15 pathways
n_missing <- 20 - nrow(plot_df)
if(n_missing > 0){
empty_df <- matrix(data = "",
nrow = n_missing,
ncol = ncol(plot_df)) %>%
as.data.frame() %>%
dplyr::mutate(Description = paste0("", seq_len(n_missing)))
plot_df <- dplyr::bind_rows(plot_df, empty_df)
}
max_label_len <- max(nchar(plot_df$Description), na.rm = TRUE)
y_text_size <- dplyr::case_when(max_label_len > 50 ~ 6,
max_label_len > 35 ~ 7,
max_label_len > 25 ~ 8,
TRUE ~ 10)
# Plot bar plot
p1 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
fill = !!color_col))+
#alpha = -log10(P.value))) +
ggplot2::geom_col(width = 0.75, na.rm = TRUE) +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label,
y = "",
title = g,
fill = "P.value") + #Direction") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_fill_manual(values = plot_colors) +
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 22, size = 6)))
#ggplot2::geom_text(aes(label =  !!size_col), x = 0, hjust = -0.1, size = 3, show.legend = FALSE)
bar_plots <- c(bar_plots, list(p1))
# Plot dot plot
vals <- c(min(plot_df[[size_col]], na.rm = TRUE), max(plot_df[[size_col]], na.rm = TRUE))
breaks <- as.vector(floor(quantile(vals) / 10) * 10)
p2 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
#fill = !!color_col,
#alpha = -log10(P.value),
color = !!color_col,
size = !!size_col)) +
ggplot2::geom_point() +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label ,
y = "",
title = g,
color = "Direction",
size = "P.value") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_color_manual(values = plot_colors) +
#scale_fill_manual(values = plot_colors) + # need for coloring the legend
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 15, size = 6))) +
ggplot2::scale_size(breaks = breaks)
dot_plot_list <- c(dot_plot_list, list(p2))
}
bar_plots <- cowplot::plot_grid(plotlist = bar_plots, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Bar_plot_pathways.tiff"),
plot = bar_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
dot_plots <- cowplot::plot_grid(plotlist = dot_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Dot_plot_pathways.tiff"),
plot = dot_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
}
bar_plots
data <- read.xlsx("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Saswat/Saswat_Pathways.xlsx")
save.dir <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/"
dot_plot_list <- list()
bar_plots <- list()
for (g in unique(data$Genes)){
df <- data %>%
dplyr::filter(Genes == g) %>%
dplyr::filter(P.value <= 0.05)
plot_colors <- c("Upregulated" = "#E69F00", "Downregulated" = "#56B4E9")
# str_wrap() wraps only between words, and it defines "words" based on spaces (" ").
# If all words are connected by "_", it wont split.
df <- df %>%
dplyr::mutate(Description = gsub(pattern = "_", replacement = " ", x = Description),
Description = stringr::str_wrap(string = Description, width = 30))
# Decide if there are multiple collections or single collection.
# If multiple, plot each collection separately,
collections <- "Reactome"
n_collections <- length(collections)
for (i in seq_len(n_collections)){
plot_df <- df %>% dplyr::filter(Collection %in% collections[i])
# Choose x axis column, size column and labels
x_col <- sym("Combined.Score")
x_label <- "Combined.Score"
size_col <- sym("P.value")
color_col <- sym("P.value")
score_var <- "Combined.Score"
x_limits <- c(0, NA)  # start at 0, auto end
df <- df %>%
dplyr::filter(!is.na(.data[[score_var]])) %>%
dplyr::arrange(dplyr::desc(.data[[score_var]]))
# Pad with empty rows if fewer than 15 pathways
n_missing <- 20 - nrow(plot_df)
if(n_missing > 0){
empty_df <- matrix(data = "",
nrow = n_missing,
ncol = ncol(plot_df)) %>%
as.data.frame() %>%
dplyr::mutate(Description = paste0("", seq_len(n_missing)))
plot_df <- dplyr::bind_rows(plot_df, empty_df)
}
max_label_len <- max(nchar(plot_df$Description), na.rm = TRUE)
y_text_size <- dplyr::case_when(max_label_len > 50 ~ 6,
max_label_len > 35 ~ 7,
max_label_len > 25 ~ 8,
TRUE ~ 10)
# Plot bar plot
p1 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
fill = !!color_col))+
#alpha = -log10(P.value))) +
ggplot2::geom_col(width = 0.75, na.rm = TRUE) +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label,
y = "",
title = g,
fill = "P.value") + #Direction") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_fill_manual(values = plot_colors) +
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 22, size = 6)))
#ggplot2::geom_text(aes(label =  !!size_col), x = 0, hjust = -0.1, size = 3, show.legend = FALSE)
bar_plots <- c(bar_plots, list(p1))
# Plot dot plot
vals <- c(min(plot_df[[size_col]], na.rm = TRUE), max(plot_df[[size_col]], na.rm = TRUE))
breaks <- as.vector(floor(quantile(vals) / 10) * 10)
p2 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
#fill = !!color_col,
#alpha = -log10(P.value),
color = !!color_col,
size = !!size_col)) +
ggplot2::geom_point() +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label ,
y = "",
title = g,
color = "Direction",
size = "P.value") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_color_manual(values = plot_colors) +
#scale_fill_manual(values = plot_colors) + # need for coloring the legend
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 15, size = 6))) +
ggplot2::scale_size(breaks = breaks)
dot_plot_list <- c(dot_plot_list, list(p2))
}
bar_plots <- cowplot::plot_grid(plotlist = bar_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Bar_plot_pathways.tiff"),
plot = bar_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
dot_plots <- cowplot::plot_grid(plotlist = dot_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Dot_plot_pathways.tiff"),
plot = dot_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
}
data <- read.xlsx("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Saswat/Saswat_Pathways.xlsx")
save.dir <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/"
dot_plot_list <- list()
bar_plot_list <- list()
for (g in unique(data$Genes)){
df <- data %>%
dplyr::filter(Genes == g) %>%
dplyr::filter(P.value <= 0.05)
plot_colors <- c("Upregulated" = "#E69F00", "Downregulated" = "#56B4E9")
# str_wrap() wraps only between words, and it defines "words" based on spaces (" ").
# If all words are connected by "_", it wont split.
df <- df %>%
dplyr::mutate(Description = gsub(pattern = "_", replacement = " ", x = Description),
Description = stringr::str_wrap(string = Description, width = 30))
# Decide if there are multiple collections or single collection.
# If multiple, plot each collection separately,
collections <- "Reactome"
n_collections <- length(collections)
for (i in seq_len(n_collections)){
plot_df <- df %>% dplyr::filter(Collection %in% collections[i])
# Choose x axis column, size column and labels
x_col <- sym("Combined.Score")
x_label <- "Combined.Score"
size_col <- sym("P.value")
color_col <- sym("P.value")
score_var <- "Combined.Score"
x_limits <- c(0, NA)  # start at 0, auto end
df <- df %>%
dplyr::filter(!is.na(.data[[score_var]])) %>%
dplyr::arrange(dplyr::desc(.data[[score_var]]))
# Pad with empty rows if fewer than 15 pathways
n_missing <- 20 - nrow(plot_df)
if(n_missing > 0){
empty_df <- matrix(data = "",
nrow = n_missing,
ncol = ncol(plot_df)) %>%
as.data.frame() %>%
dplyr::mutate(Description = paste0("", seq_len(n_missing)))
plot_df <- dplyr::bind_rows(plot_df, empty_df)
}
max_label_len <- max(nchar(plot_df$Description), na.rm = TRUE)
y_text_size <- dplyr::case_when(max_label_len > 50 ~ 6,
max_label_len > 35 ~ 7,
max_label_len > 25 ~ 8,
TRUE ~ 10)
# Plot bar plot
p1 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
fill = !!color_col))+
#alpha = -log10(P.value))) +
ggplot2::geom_col(width = 0.75, na.rm = TRUE) +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label,
y = "",
title = g,
fill = "P.value") + #Direction") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_fill_manual(values = plot_colors) +
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 22, size = 6)))
#ggplot2::geom_text(aes(label =  !!size_col), x = 0, hjust = -0.1, size = 3, show.legend = FALSE)
bar_plots <- c(bar_plots, list(p1))
# Plot dot plot
vals <- c(min(plot_df[[size_col]], na.rm = TRUE), max(plot_df[[size_col]], na.rm = TRUE))
breaks <- as.vector(floor(quantile(vals) / 10) * 10)
p2 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
#fill = !!color_col,
#alpha = -log10(P.value),
color = !!color_col,
size = !!size_col)) +
ggplot2::geom_point() +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label ,
y = "",
title = g,
color = "Direction",
size = "P.value") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_color_manual(values = plot_colors) +
#scale_fill_manual(values = plot_colors) + # need for coloring the legend
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 15, size = 6))) +
ggplot2::scale_size(breaks = breaks)
dot_plot_list <- c(dot_plot_list, list(p2))
}
bar_plots <- cowplot::plot_grid(plotlist = bar_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Bar_plot_pathways.tiff"),
plot = bar_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
dot_plots <- cowplot::plot_grid(plotlist = dot_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Dot_plot_pathways.tiff"),
plot = dot_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
}
data <- read.xlsx("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/Past/Saswat/Saswat_Pathways.xlsx")
save.dir <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/"
dot_plot_list <- list()
bar_plot_list <- list()
for (g in unique(data$Genes)){
df <- data %>%
dplyr::filter(Genes == g) %>%
dplyr::filter(P.value <= 0.05)
plot_colors <- c("Upregulated" = "#E69F00", "Downregulated" = "#56B4E9")
# str_wrap() wraps only between words, and it defines "words" based on spaces (" ").
# If all words are connected by "_", it wont split.
df <- df %>%
dplyr::mutate(Description = gsub(pattern = "_", replacement = " ", x = Description),
Description = stringr::str_wrap(string = Description, width = 30))
# Decide if there are multiple collections or single collection.
# If multiple, plot each collection separately,
collections <- "Reactome"
n_collections <- length(collections)
for (i in seq_len(n_collections)){
plot_df <- df %>% dplyr::filter(Collection %in% collections[i])
# Choose x axis column, size column and labels
x_col <- sym("Combined.Score")
x_label <- "Combined.Score"
size_col <- sym("P.value")
color_col <- sym("P.value")
score_var <- "Combined.Score"
x_limits <- c(0, NA)  # start at 0, auto end
df <- df %>%
dplyr::filter(!is.na(.data[[score_var]])) %>%
dplyr::arrange(dplyr::desc(.data[[score_var]]))
# Pad with empty rows if fewer than 15 pathways
n_missing <- 20 - nrow(plot_df)
if(n_missing > 0){
empty_df <- matrix(data = "",
nrow = n_missing,
ncol = ncol(plot_df)) %>%
as.data.frame() %>%
dplyr::mutate(Description = paste0("", seq_len(n_missing)))
plot_df <- dplyr::bind_rows(plot_df, empty_df)
}
max_label_len <- max(nchar(plot_df$Description), na.rm = TRUE)
y_text_size <- dplyr::case_when(max_label_len > 50 ~ 6,
max_label_len > 35 ~ 7,
max_label_len > 25 ~ 8,
TRUE ~ 10)
# Plot bar plot
p1 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
fill = !!color_col))+
#alpha = -log10(P.value))) +
ggplot2::geom_col(width = 0.75, na.rm = TRUE) +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label,
y = "",
title = g,
fill = "P.value") + #Direction") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_fill_manual(values = plot_colors) +
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 22, size = 6)))
#ggplot2::geom_text(aes(label =  !!size_col), x = 0, hjust = -0.1, size = 3, show.legend = FALSE)
bar_plot_list <- c(bar_plot_list, list(p1))
# Plot dot plot
vals <- c(min(plot_df[[size_col]], na.rm = TRUE), max(plot_df[[size_col]], na.rm = TRUE))
breaks <- as.vector(floor(quantile(vals) / 10) * 10)
p2 <- ggplot2::ggplot(data = plot_df,
aes(x = !!x_col,
y = reorder(Description, !!x_col),
#fill = !!color_col,
#alpha = -log10(P.value),
color = !!color_col,
size = !!size_col)) +
ggplot2::geom_point() +
ggplot2::theme_classic() +
ggplot2::labs(x = x_label ,
y = "",
title = g,
color = "Direction",
size = "P.value") +
custom_theme +
theme(axis.text.y = element_text(size = y_text_size)) +
coord_cartesian(clip = "off") +
scale_x_continuous(limits = x_limits, expand = expansion(mult = c(0, 0.05))) +
scale_alpha_continuous(range = c(0.5, 1)) +
#scale_color_manual(values = plot_colors) +
#scale_fill_manual(values = plot_colors) + # need for coloring the legend
guides(fill = guide_legend(override.aes = list(shape = 22, size = 6)),
color = guide_legend(override.aes = list(shape = 22, size = 6)),
alpha = guide_legend(override.aes = list(shape = 15, size = 6))) +
ggplot2::scale_size(breaks = breaks)
dot_plot_list <- c(dot_plot_list, list(p2))
}
bar_plots <- cowplot::plot_grid(plotlist = bar_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Bar_plot_pathways.tiff"),
plot = bar_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
dot_plots <- cowplot::plot_grid(plotlist = dot_plot_list, ncol = 3, nrow = 2)
ggplot2::ggsave(filename = paste0("Dot_plot_pathways.tiff"),
plot = dot_plots,
device = "jpeg",
path = file.path(save.dir),
width = 3*7,
height = 3*7,
units = "in",
dpi = 300,
bg = "white")
}
plot.params <- list(Pre.Integration.PCA.           = c("sct.pca",            "Sample", "cluster.0.8.harmony"),
Post.Integration.PCA.          = c("integrated.harmony", "Sample", "cluster.0.8.harmony"),
UMAP.Sample.                   = c("umap.harmony",       "Sample", "cluster.0.8.harmony"),
UMAP.Phase.                    = c("umap.harmony",       "Phase",  "cluster.0.8.harmony"),
UMAP.All.Resolutions.CCA       = c("umap.cca",            NA,      "All"),
UMAP.All.Resolutions.RPCA.     = c("umap.rpca",           NA,      "All"),
UMAP.All.Resolutions.JointPCA. = c("umap.jointpca",       NA,      "All"),
UMAP.All.Resolutions.Harmony.  = c("umap.harmony",        NA,      "All"),
UMAP.Singlets.Doublets.        = c("umap.harmony",        NA,      "cluster.0.8.harmony"),
UMAP.Numerical.Metrics.        = c("umap.harmony",        NA,      "cluster.0.8.harmony"))
plot.params <- list(Pre.Integration.PCA.           = c("sct.pca",            "Sample", "cluster.0.8.harmony"),
Post.Integration.PCA.          = c("integrated.harmony", "Sample", "cluster.0.8.harmony"),
UMAP.Sample.                   = c("umap.harmony",       "Sample", "cluster.0.8.harmony"),
UMAP.Phase.                    = c("umap.harmony",       "Phase",  "cluster.0.8.harmony"),
UMAP.All.Resolutions.CCA       = c("umap.cca",            NA,      "All"),
UMAP.All.Resolutions.RPCA.     = c("umap.rpca",           NA,      "All"),
UMAP.All.Resolutions.JointPCA. = c("umap.jointpca",       NA,      "All"),
UMAP.All.Resolutions.Harmony.  = c("umap.harmony",        NA,      "All"),
UMAP.Singlets.Doublets.        = c("umap.harmony",        NA,      "cluster.0.8.harmony"),
UMAP.Numerical.Metrics.        = c("umap.harmony",        NA,      "cluster.0.8.harmony"))
i <- 1
(sum(plot.params[[i]][2] %in% colnames(integrated.seurat@meta.data)) > 0) &
(sum(plot.params[[i]][1] %in% names(integrated.seurat@reductions)) > 0) &
(sum(plot.params[[i]][3] %in% colnames(integrated.seurat@meta.data)) > 0)
