# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = TRUE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "quartile", #optimal",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = TRUE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "tertile", #optimal",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = TRUE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "optimal",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "optimal",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
expr_data <- expr_custom %>%
dplyr::filter(pheno == group) %>%
dplyr::select(-pheno) %>%
tibble::column_to_rownames("AnonymID") %>%
t()
log_norm_counts <- log(1+expr_data, base=2)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "optimal",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
survival_analysis(meta_data, log_norm_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "median",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
survival_analysis(meta_data, log_norm_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "median",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "quartile",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "quartile",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
survival_analysis(meta_data, log_norm_counts, survival_params)
#survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "tertile",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
survival_analysis(meta_data, log_norm_counts, survival_params)
#survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "tertile",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "thirds",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
#survival_analysis(meta_data, log_norm_counts, survival_params)
survival_analysis(meta_data, median_counts, survival_params)
survival_params <- list(
# ---- Stratification (Expression + Metadata-based survival) ----
stratify_var     = marker_cols,          # one or more genes or metadata columns
sig_score        = FALSE,          # TRUE = combine genes into one signature score
substratify_var  = NULL,          # optional metadata column for sub-stratification
facet_var        = NULL,          # optional faceting variable
# ---- Cutoff settings (ONLY for Expression-based survival) ----
cutoff_method    = "thirds",      # median, quartile, tertile, optimal, thirds
show_all_bins    = FALSE,          # TRUE = plot all bins (LOW, HIGH, MID/MED_HIGH/MED_LOW)
multiple_cutoff  = FALSE,          # TRUE = compute cutoffs separately for substratify_var
# ---- Plot settings ----
conf_interval    = FALSE,          # TRUE = show confidence interval in survival curve
plot_curve       = TRUE,           # TRUE = plot the survival curve
plot_risk_table  = TRUE,           # TRUE = plot the risk table below the curve
color_palette    = custom_palette, # vector of colors for groups c("#d73027","#0c2c84")
# ---- Survival data columns ----
time_col         = "Time",         # metadata column containing Time values
status_col       = "Status",       # metadata column containing Status values
# ---- Output ----
prefix           = "",
output_path      = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/metapheno1", group)
#output_path     = file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/pheno1", group)
)
#survival_analysis(meta_data, expr_data, survival_params)
survival_analysis(meta_data, log_norm_counts, survival_params)
#survival_analysis(meta_data, median_counts, survival_params)
files <- list.files("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom")
files.full <- list.files("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", full.names = TRUE)
full.df <- data.frame()
files.full <- list.files("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", full.names = TRUE)
for (f in files.full){
df <- read.xlsx(f) %>%
dplyr::mutate(Comparison = gsub("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom/", "", f))
full.df <- bind_rows(full.df, df)
}
f
full.df <- data.frame()
files.full <- list.files("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom", full.names = TRUE)
for (f in files.full){
df <- read.xlsx(f) %>%
dplyr::mutate(Comparison = gsub("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/custom/", "", f))
full.df <- bind_rows(full.df, df)
}
View(full.df)
gsub(".xlsx", "",full.df$Comparison)
sub(".xlsx|Survival_Stats.", "",full.df$Comparison)
gsub("$.xlsx|^Survival_Stats.", "",full.df$Comparison)
gsub("$\\.xlsx|^Survival_Stats\\.", "",full.df$Comparison)
gsub("\\.xlsx$|^Survival_Stats\\.", "",full.df$Comparison)
full.df$Comparison <- gsub("\\.xlsx$|^Survival_Stats\\.", "",full.df$Comparison)
full.df <- full.df %>%
separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
)
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
)
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, gene, cutoff, trasform, everything())
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, gene, cutoff, transform, everything())
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, cutoff, transform, everything())
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, cutoff, transform, HR, pval, CI_lower, CI_upper, everything())
full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, cutoff, transform, HR, pval, CI_lower, CI_upper, everything()) %>%
arrange(Gene, cutoff, transform)
full.df <- full.df %>%
tidyr::separate(
col = Comparison,         # Column to split
into = c("cutoff", "transform", "gene"),  # Names of new columns
sep = "\\.",              # Delimiter (dot is special, so escape it)
fill = "right",           # If fewer than 3 parts, fill with NA
remove = TRUE             # Remove original column
) %>%
dplyr::select(Gene, cutoff, transform, HR, pval, CI_lower, CI_upper, everything()) %>%
arrange(Gene, cutoff, transform)
write_xlsx(full.df, path = "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/output.xlsx")
wb <- createWorkbook()
addWorksheet(wb, "Sheet1")
writeData(wb, "Sheet1", full.df)
saveWorkbook(wb, "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/output.xlsx", overwrite = TRUE)
plot_upset <- function(listInput = NULL, selected_sets = NULL,
min_intersection_size = NULL, filename = "Upset_Plot",
output_path = getwd()) {
# Default example list if none provided
if (is.null(listInput)) {
listInput <- list(
DMPK = c(1,2,3,4,5,6,7,8,9,11,16,17),
MAPK1 = c(1,2,3,4,5,6,7,8,9,16,17,18),
RAF1 = c(1,2,3,4,5,6,7,8,9,16,17,18),
ROCK1 = c(1,2,3,4,5,6,7,8,9,17,18),
PIM1 = c(1,2,3,4,5,6,7,8,9,17),
DYRK2 = c(1,2,3,4,5,6,7,8,9,17),
STK26 = c(1,2,3,4,5,6,7,8,9,17),
MAP2K2 = c(1,2,3,4,5,6,7,8,9),
LIMK1 = c(1,2,3,4,5,6,7,8,9),
MYO3A = c(1,2,3,4,5,6,7,8,9),
TSSK1B = c(1,2,3,4,5,6,7,8,9),
HIPK4 = c(1,2,3,4,5,6,7,8,9),
DCLK1 = c(1,2,3,4,5,6,7,8,9),
NEK3 = c(1,2,3,4,5,6,7,8,9),
CDKL1 = c(1,2,3,4,5,6,7,8,9),
TRPM7 = c(1,2,3,4,5,6,7,8,10,11,12,13,14,15),
MAPK7 = c(1,2,3,4,5,6,7,8,17),
IKBKE = c(1,2,4,5,6,7,8,9,17),
PRKAG3 = c(1,2,4,5,6,7,8,9),
TAF1L = c(1,2,4,5),
JAK2 = c(2,4,5,6,7,8,9,16,17,18)
)
selected_sets <- c("DCLK1", "MAPK1", "CDKL1", "ROCK1", "MAPK7",
"HIPK4", "MAP2K2", "DYRK2")
min_intersection_size <- 5
}
# Convert list to UpSetR input format
upset_data <- UpSetR::fromList(listInput)
# Create UpSet plot
p <- UpSetR::upset(data = upset_data,
empty.intersections = "on",
cutoff = min_intersection_size,       # minimum intersection size to show
mb.ratio = c(0.5, 0.5),               # ratio between main bar and sets bar
sets = selected_sets,                  # sets to display (order matters)
order.by = "freq",                     # order intersections by frequency
main.bar.color = "#1f78b4",            # nicer color for bars
sets.bar.color = "#33a02c",
text.scale = c(2, 2, 1.5, 1.5, 2, 1.5) # scale axis and text sizes
)
# Convert to ggplot object for saving
ggplot_obj <- ggplotify::as.ggplot(p)
# Save plot
ggsave(filename = file.path(output_path, paste0(filename, ".jpg")),
plot = ggplot_obj,
height = 11,
width = 11
)
message("UpSet plot saved to: ", file.path(output_path, paste0(filename, ".jpg")))
return(ggplot_obj)
}
plot_upset()
