test.for.trend = FALSE,
combine = FALSE)
} else {
HR <- round(exp(cox_model$coefficients[[1]]),2)
CI <- round(exp(confint(cox_model)),2)
p_val <- survminer::surv_pvalue(fit = survival_curve,
stratify_criteria = "survdiff",
test.for.trend = FALSE,
combine = FALSE)
}
} else {
HR <- 0
CI <- c(0, 0)
p_val <- c(0, 0)
}
# Plot the survival curve using survminer::ggsurvplot() instead of base::plot()
# ggsurvplot() produces a list of ggplot objects: a survival curve and a risk table
# Saving it using cowplot() first and then using ggsave() works nicely as
# compared to saving directly using ggsave()
if(plot_curve =="TRUE"){
# Plot the survival curve
legend_label <- survival_data %>%
dplyr::count(model) %>%
dplyr::select(model) %>%
unlist(.,use.names=FALSE)
survival_plot <- survminer::ggsurvplot(fit = survival_curve,
pval = FALSE,
conf.int = confidence_interval,
risk.table = plot_risk_table,
legend.title = legend_title,
legend.labs = legend_label,
palette = color_palette,
break.time.by = 12,                # break X axis in time intervals by 3 months
xlab = "Time (Months)",           # customize X axis label
ylab = "Survival Probability",    # customize Y axis label
title = dplyr::if_else(gene == "combined.exp", "", gene),
risk.table.y.text.col = T,        # colour risk table text annotations
size = 2,
censor.size = 9)
# Plot p and HR value
grob1 <- grobTree(textGrob(label = paste0("p = ", formatC(p_val[[2]], format = "e", digits = 1),
"\nHR = ", round(HR,1), " [", round(CI[1],1), ", ", round(CI[2],1), "]"),
x = 0.50,
y = 0.90,
hjust = 0,
gp = grid::gpar(fontfamily="Times", fontface="bold", col="black", fontsize=15)))
# Add p values and HR values to plot
survival_plot$plot <- survival_plot$plot %++%
ggplot2::annotation_custom(grob1)
cowplot::plot_grid(plotlist = survival_plot,
align = "hv",
axis = "tblr",
nrow = 2,
ncol = 1,
rel_widths = 1,
rel_heights = c(1,0.45),
labels = NULL,
label_size = 14,
label_fontfamily = NULL,
label_fontface = "bold",
label_colour = NULL,
label_x = 0,
label_y = 1,
hjust = -0.5,
vjust = 1.5)
# Save the plot
ggplot2::ggsave(filename = gsub("/", "-", x=paste0(gse, "_", group, "_", stratify_criteria, "_", gene, ".pdf")),
plot = last_plot(),
device = "pdf",
path = parent_path,
scale = 1,
width = 6,
height = 7,
units = c("in"),
dpi = 600,
limitsize = TRUE,
bg = NULL)
}
} else {
HR <- 0
CI <- c(0, 0)
p_val <- c(0, 0)
}
# Create a list to store survival stats
ls <- list("group" = c(), "HR" = c(), "CI_lower" = c(), "CI_upper" = c(), "pvalue" =c())
ls$group <- c(group)
ls$HR <- c(HR)
ls$CI_lower <- c(CI[1])
ls$CI_upper <- c(CI[2])
ls$pvalue <- c(p_val[[2]])
return(ls)
}
plot_curve <- TRUE
summary <- wrangle_data(stratify_criteria)
plot_curve <- TRUE
summary <- wrangle_data(stratify_criteria)
y_18 <- c("DDX3Y", "EIF1AY", "HSFY2", "KDM5D", "UTY", "NLGN4Y", "PCDH11Y",
"RPS4Y1", "TBL1Y", "TMSB4Y", "USP9Y", "ZFY", "DAZ1", "DAZ2", "DAZ3",
"DAZ4", "PRY2", "RBMY1A1")
list(y_18)
which(tolower(y_seurat)==tolower(y_all))
clusters <- list("Fibroblasts" = c(7,30,34,41),
"Myofibroblasts" = c(22,28,44,6),
"Epithelial" = c(),
"Myeloid - Macrophages" = c(11,13,37,45),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(39),
"Myeloid - Mast" = c(15,21),
"Lymphoid - B" = c(0,36),
"Lymphoid - Plasma" = c(26),
"Lymphoid - T" = c(3,8,12,18,29,40,47,2,14,24,17,5),
"Lymphoid - NK" = c(),
"Endothelial" = c(4,23,33,43),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
unlist(clusters, use.names = FALSE)
sort(unlist(clusters, use.names = FALSE))
clusters <- list("Fibroblasts" = c(9,27,45,38),
"Myofibroblasts" = c(2,23,49,48),
"Epithelial" = c(4,6,7,12,18,46,17,22,32,26,28,15,43,30,39,35,19),
"Myeloid - Macrophages" = c(13,20),
"Myeloid - DCs" = c(37),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(41),
"Myeloid - Mast" = c(10,24,52),
"Lymphoid - B" = c(0,34,54,36,44,47),
"Lymphoid - Plasma" = c(31),
"Lymphoid - T" = c(8,11,42,5,25,40),
"Lymphoid - NK" = c(1,14,16,29,33),
"Endothelial" = c(3,21,50,51),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
unlist(clusters, use.names=FALSE)
sort(unlist(clusters, use.names=FALSE))
setdiff(sort(unlist(clusters, use.names=FALSE)), seq(0,54))
setdiff(seq(0,54),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(4,12,22,8,39,11,18,27,16,24,40,21),
"Myofibroblasts" = c(35),
"Epithelial" = c(0,1,5,7,15,25,30,48,46,49),
"Myeloid - Macrophages" = c(3,20,29,32,36),
"Myeloid - DCs" = c(38),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(9,14,17,19,26),
"Lymphoid - B" = c(2,47),
"Lymphoid - Plasma" = c(44),
"Lymphoid - T" = c(10,13,23,28),
"Lymphoid - NK" = c(33),
"Endothelial" = c(6,43,45,31),
"Endothelial - Lymphatic" = c(37),
"Neurons" = c(41),
"Myocytes" = c(),
"Erythrocytes" = c(34),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(4,12,22,8,39,11,18,27,16,24,40,21,42,50),
"Myofibroblasts" = c(35),
"Epithelial" = c(0,1,5,7,15,25,30,48,46,49),
"Myeloid - Macrophages" = c(3,20,29,32,36),
"Myeloid - DCs" = c(38),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(9,14,17,19,26),
"Lymphoid - B" = c(2,47),
"Lymphoid - Plasma" = c(44),
"Lymphoid - T" = c(10,13,23,28),
"Lymphoid - NK" = c(33),
"Endothelial" = c(6,43,45,31),
"Endothelial - Lymphatic" = c(37),
"Neurons" = c(41),
"Myocytes" = c(),
"Erythrocytes" = c(34),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(3,9,20,39,31,26),
"Myofibroblasts" = c(30),
"Epithelial" = c(18,28,0,1,2,4,5,6,7,12,13,14,16,21,22,25,29,35,37,41),
"Myeloid - Macrophages" = c(8,10,34,19,32),
"Myeloid - DCs" = c(33),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(11,17,24,38),
"Lymphoid - B" = c(),
"Lymphoid - Plasma" = c(),
"Lymphoid - T" = c(),
"Lymphoid - NK" = c(),
"Endothelial" = c(23,27,36),
"Endothelial - Lymphatic" = c(40),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(3,9,20,39,31,26),
"Myofibroblasts" = c(30),
"Epithelial" = c(18,28,0,1,2,4,5,6,7,12,13,14,15,16,21,22,25,29,35,37,41),
"Myeloid - Macrophages" = c(8,10,34,19,32),
"Myeloid - DCs" = c(33),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(11,17,24,38),
"Lymphoid - B" = c(),
"Lymphoid - Plasma" = c(),
"Lymphoid - T" = c(),
"Lymphoid - NK" = c(),
"Endothelial" = c(23,27,36),
"Endothelial - Lymphatic" = c(40),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(14,19),
"Myofibroblasts" = c(20,27,28),
"Epithelial" = c(),
"Myeloid - Macrophages" = c(22,31),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(21),
"Myeloid - Mast" = c(33),
"Lymphoid - B" = c(18),
"Lymphoid - Plasma" = c(34,38,29),
"Lymphoid - T" = c(2,5,8,10,37,40,36),
"Lymphoid - NK" = c(15,16),
"Endothelial" = c(1,6,23,35,42),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(41),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(14,19),
"Myofibroblasts" = c(20,27,28),
"Epithelial" = c(0,3,4,7,9,11,12,13,17,24,25,26,30,32),
"Myeloid - Macrophages" = c(22,31),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(21),
"Myeloid - Mast" = c(33),
"Lymphoid - B" = c(18),
"Lymphoid - Plasma" = c(34,38,29),
"Lymphoid - T" = c(2,5,8,10,37,40,36),
"Lymphoid - NK" = c(15,16),
"Endothelial" = c(1,6,23,35,42),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(41),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(14,19),
"Myofibroblasts" = c(20,27,28),
"Epithelial" = c(0,3,4,7,9,11,12,13,17,24,25,26,30,32,39,43),
"Myeloid - Macrophages" = c(22,31),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(21),
"Myeloid - Mast" = c(33),
"Lymphoid - B" = c(18),
"Lymphoid - Plasma" = c(34,38,29),
"Lymphoid - T" = c(2,5,8,10,37,40,36),
"Lymphoid - NK" = c(15,16),
"Endothelial" = c(1,6,23,35,42),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(41),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(9,27),
"Myofibroblasts" = c(2,23,38,48,49),
"Epithelial" = c(),
"Myeloid - Macrophages" = c(13,20),
"Myeloid - DCs" = c(37),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(41),
"Myeloid - Mast" = c(10,24,52),
"Lymphoid - B" = c(0,34,54,36,44,47),
"Lymphoid - Plasma" = c(31,53),
"Lymphoid - T" = c(5,8,11,42,25,40),
"Lymphoid - NK" = c(1,14,16,29,33),
"Endothelial" = c(3,50,51),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(9,27),
"Myofibroblasts" = c(2,23,38,48,49),
"Epithelial" = c(4,6,7,12,15,17,18,19,21,22,26,28,30,32,35,39,43,45,46,24,38),
"Myeloid - Macrophages" = c(13,20),
"Myeloid - DCs" = c(37),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(41),
"Myeloid - Mast" = c(10,52),
"Lymphoid - B" = c(0,34,54,36,44,47),
"Lymphoid - Plasma" = c(31,53),
"Lymphoid - T" = c(5,8,11,42,25,40),
"Lymphoid - NK" = c(1,14,16,29,33),
"Endothelial" = c(3,50,51),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,50),sort(unlist(clusters, use.names=FALSE)))
duplicated(sort(unlist(clusters, use.names=FALSE)))
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(9,27),
"Myofibroblasts" = c(2,23,48,49),
"Epithelial" = c(4,6,7,12,15,17,18,19,22,26,28,30,32,35,39,43,45,46,24,38),
"Myeloid - Macrophages" = c(13,20),
"Myeloid - DCs" = c(37),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(41),
"Myeloid - Mast" = c(10,52),
"Lymphoid - B" = c(0,34,54,36,44,47),
"Lymphoid - Plasma" = c(31,53),
"Lymphoid - T" = c(5,8,11,42,25,40),
"Lymphoid - NK" = c(1,14,16,29,33),
"Endothelial" = c(3,50,51,21),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(10,18),
"Myofibroblasts" = c(37),
"Epithelial" = c(0,2,4,9,11,16,19,21,33,28),
"Myeloid - Macrophages" = c(13,15,23),
"Myeloid - DCs" = c(35),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(20,22,25),
"Lymphoid - B" = c(7,32),
"Lymphoid - Plasma" = c(30),
"Lymphoid - T" = c(8,24,31,5,1,6,3,14,12,29,38,17),
"Lymphoid - NK" = c(),
"Endothelial" = c(27,36),
"Endothelial - Lymphatic" = c(34),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(10,18),
"Myofibroblasts" = c(37),
"Epithelial" = c(0,2,4,9,11,16,19,21,33,28),
"Myeloid - Macrophages" = c(13,15,23),
"Myeloid - DCs" = c(35),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(20,22,25),
"Lymphoid - B" = c(7,32),
"Lymphoid - Plasma" = c(30),
"Lymphoid - T" = c(8,24,31,5,1,6,3,14,12,29,38,17,26),
"Lymphoid - NK" = c(),
"Endothelial" = c(27,36),
"Endothelial - Lymphatic" = c(34),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(26),
"Myofibroblasts" = c(),
"Epithelial" = c(19),
"Myeloid - Macrophages" = c(0,8,29,24),
"Myeloid - DCs" = c(28),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(2,6,9,14,16,20,21),
"Lymphoid - B" = c(27),
"Lymphoid - Plasma" = c(),
"Lymphoid - T" = c(5,7,17,23,25,1,3,4,10,11,12,13,30),
"Lymphoid - NK" = c(),
"Endothelial" = c(31),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(26),
"Myofibroblasts" = c(),
"Epithelial" = c(19),
"Myeloid - Macrophages" = c(0,8,29,24,22),
"Myeloid - DCs" = c(28),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(2,6,9,14,16,20,21),
"Lymphoid - B" = c(27),
"Lymphoid - Plasma" = c(),
"Lymphoid - T" = c(5,7,17,23,25,1,3,4,10,11,12,13,30),
"Lymphoid - NK" = c(),
"Endothelial" = c(31),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c(15,18))
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(13,21,27),
"Myofibroblasts" = c(12,19,11,18,28,29),
"Epithelial" = c(0,2,4,6,7,9,10,24,25,26,33,34),
"Myeloid - Macrophages" = c(),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(31),
"Myeloid - Mast" = c(),
"Lymphoid - B" = c(),
"Lymphoid - Plasma" = c(20),
"Lymphoid - T" = c(14),
"Lymphoid - NK" = c(),
"Endothelial" = c(22),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,60),sort(unlist(clusters, use.names=FALSE)))
setdiff(seq(0,36),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(13,21,27),
"Myofibroblasts" = c(12,19,11,18,28,29),
"Epithelial" = c(0,2,4,6,7,9,10,24,25,26,33,34),
"Myeloid - Macrophages" = c(),
"Myeloid - DCs" = c(),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(31),
"Myeloid - Mast" = c(),
"Lymphoid - B" = c(),
"Lymphoid - Plasma" = c(20),
"Lymphoid - T" = c(14),
"Lymphoid - NK" = c(),
"Endothelial" = c(22),
"Endothelial - Lymphatic" = c(35),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c())
setdiff(seq(0,36),sort(unlist(clusters, use.names=FALSE)))
setdiff(seq(0,35),sort(unlist(clusters, use.names=FALSE)))
setdiff(seq(0,35),sort(unlist(clusters, use.names=FALSE)))
clusters <- list("Fibroblasts" = c(26),
"Myofibroblasts" = c(),
"Epithelial" = c(19),
"Myeloid - Macrophages" = c(0,8,29,24,22),
"Myeloid - DCs" = c(28),
"Myeloid - MDSC" = c(),
"Myeloid - Granulocytes" = c(),
"Myeloid - Mast" = c(2,6,9,14,16,20,21),
"Lymphoid - B" = c(27),
"Lymphoid - Plasma" = c(),
"Lymphoid - T" = c(5,7,17,23,25,1,3,4,10,11,12,13,30),
"Lymphoid - NK" = c(),
"Endothelial" = c(31),
"Endothelial - Lymphatic" = c(),
"Neurons" = c(),
"Myocytes" = c(),
"Erythrocytes" = c(),
"Unclassified" = c(15,18))
sort(unlist(clusters, use.names=FALSE))
c(19,18,6,31,28,25)
if (proj=="scRNASeq_BBN_C57B6"){
reduc <- "Harmony"
Mixed <- list("Epithelial" = c(19,18,25,28,6,31),
"Fibroblasts" = c(27,29,30,10),
"Myeloid" = c(23,31,22,25),
"Lymphoid" = c(25,17,20))
}
Mixed <- list("Epithelial" = c(19,18,25,28,6,31),
"Fibroblasts" = c(27,29,30,10),
"Myeloid" = c(23,31,22,25),
"Lymphoid" = c(25,17,20))
Mixed <- list("Epithelial" = c(19,18,25,28,6,31),
"Fibroblasts" = c(27,29,30,10),
"Myeloid" = c(23,31,22,25),
"Lymphoid" = c(25,17,20,))
Mixed <- list("Epithelial" = c(19,18,25,28,6,31),
"Fibroblasts" = c(27,29,30,10),
"Myeloid" = c(23,31,22,25),
"Lymphoid" = c(25,17,20))
Mixed <- list("Epithelial" = c(5,51,30,13,33,24,38,23,45),
"Fibroblasts" = c(34,16,14,22,31),
"Myeloid" = c(39,37,15,36,34,39),
"Lymphoid" = c())
Mixed <- list("Epithelial" = c(37,21,36,18),
"Fibroblasts" = c(16,13,14),
"Myeloid" = c(15,11,17),
"Lymphoid" = c(18,9,30))
Mixed <- list("Epithelial" = c(14,15,22,24),
"Fibroblasts" = c(19,10),
"Myeloid" = c(15,18,1,11),
"Lymphoid" = c(28,34))
Mixed <- list("Epithelial" = c(23,26,31,5),
"Fibroblasts" = c(15,14,11),
"Myeloid" = c(10,18,27,22),
"Lymphoid" = c(16,29,30))
Mixed <- list("Epithelial" = c(5),
"Fibroblasts" = c(),
"Myeloid" = c(12,19),
"Lymphoid" = c(18))
lengths(Mixed)[[celltype]]
