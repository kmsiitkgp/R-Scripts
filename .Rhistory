raw_matrix_dir         <- file.path(proj_dir, "06.Matrix", "raw_feature_bc_matrix")
filt_matrix_dir        <- file.path(proj_dir, "06.Matrix", "filt_feature_bc_matrix")
hto_matrix_dir         <- file.path(proj_dir, "06.Matrix", "HTO_bc_matrix")
seurat_dir             <- file.path(proj_dir, "Seurat")
sc_deseq2_dir          <- file.path(proj_dir, "DESeq2")
pyscenic_dir           <- file.path(proj_dir, "pySCENIC")
scvelo_dir             <- file.path(proj_dir, "scVelo")
velocyto_dir           <- file.path(proj_dir, "velocyto")
cellphonedb_dir        <- file.path(proj_dir, "CellphoneDB")
cellchat_dir           <- file.path(proj_dir, "CellChat")
# ---- ğŸ§¬ Cell Marker and Gene Set Extraction ----
markers <- list()
s_genes <- c()
g2m_genes <- c()
if (!is.null(scripts_dir)){
metafile               <- file.path(scripts_dir, "scRNASeq_Metadata", paste0(proj, "_Metadata.xlsx"))
markerfile             <- file.path(scripts_dir, "Cell_Type_Markers.xlsx")
cell.cycle.marker.file <- file.path(scripts_dir, "Cell_Cycle_Markers.xlsx")
# Extract Cell Cycle Genes (Human and Mouse)
if (file.exists(cell.cycle.marker.file)) {
cc_markers <- openxlsx::read.xlsx(cell.cycle.marker.file)
# Combine Human and Mouse genes for each phase
s_genes <- c(cc_markers$Human_Gene[cc_markers$Phase == "S"],
cc_markers$Mouse_Gene[cc_markers$Phase == "S"])
g2m_genes <- c(cc_markers$Human_Gene[cc_markers$Phase == "G2/M"],
cc_markers$Mouse_Gene[cc_markers$Phase == "G2/M"])
# Clean up potential NA/empty values resulting from unlist/subsetting
s_genes <- s_genes[!is.na(s_genes) & s_genes != ""]
g2m_genes <- g2m_genes[!is.na(g2m_genes) & g2m_genes != ""]
}
} else{
metafile <- NULL
}
# ---- ğŸ“¦ Final Project Parameters Construction ----
proj.params <- c(
list(
# Project info
proj        = proj,
species     = species,
# Bulk RNA-seq directories
proj_dir    = normalizePath(proj_dir,     mustWork = FALSE),
counts_dir  = normalizePath(counts_dir,   mustWork = FALSE),
gmt_dir     = normalizePath(gmt_dir,      mustWork = FALSE),
contrast_dir= normalizePath(contrast_dir, mustWork = FALSE),
deseq2_dir  = normalizePath(deseq2_dir,   mustWork = FALSE),
pathway_dir = normalizePath(pathway_dir,  mustWork = FALSE),
tf_dir      = normalizePath(tf_dir,       mustWork = FALSE),
# Bulk RNA-seq parameters
contrasts   = contrasts,
deseq2      = deseq2.params,
heatmap     = heatmap.params,
volcano     = volcano.params,
# Single cell RNA-seq directories
diagnostics_dir  = normalizePath(diagnostics_dir, mustWork = FALSE),
demux_dir        = normalizePath(demux_dir,       mustWork = FALSE),
raw_matrix_dir   = normalizePath(raw_matrix_dir,  mustWork = FALSE),
filt_matrix_dir  = normalizePath(filt_matrix_dir, mustWork = FALSE),
hto_matrix_dir   = normalizePath(hto_matrix_dir,  mustWork = FALSE),
seurat_dir       = normalizePath(seurat_dir,      mustWork = FALSE),
sc_deseq2_dir    = normalizePath(sc_deseq2_dir,   mustWork = FALSE),
pyscenic_dir     = normalizePath(pyscenic_dir,    mustWork = FALSE),
scvelo_dir       = normalizePath(scvelo_dir,      mustWork = FALSE),
velocyto_dir     = normalizePath(velocyto_dir,    mustWork = FALSE),
cellphonedb_dir  = normalizePath(cellphonedb_dir, mustWork = FALSE),
cellchat_dir     = normalizePath(cellchat_dir,    mustWork = FALSE),
# Single cell data
metafile         = normalizePath(metafile,        mustWork = FALSE),
markerfile       = normalizePath(markerfile,      mustWork = FALSE),
cell_cycle       = list(S = s_genes, G2M = g2m_genes)
)
)
# ---- âš ï¸ Final Checks and Return ----
if (proj == "") warning("âš ï¸ Project name is empty")
if (species == "") warning("âš ï¸ Species is not set")
if (length(contrasts) == 0) warning("âš ï¸ No contrasts specified")
return(proj.params)
}
proj.params <- setup_project(proj             = proj,
species          = species,  #"Mus musculus", "Homo sapiens"
contrasts        = contrasts,
parent_dir       = parent_dir,
gmt_dir          = gmt_dir,
scripts_dir      = scripts_dir,
deseq2.override  = deseq2.override,
heatmap.override = heatmap.override,
volcano.override = volcano.override)
file.path(proj.params$proj_dir, paste0(proj.params$proj, "_Raw_counts.xlsx"))
proj
species
contrasts
parent_dir
gmt_dir
scripts_dir
deseq2.override
heatmap.override
volcano.override
metafile         <- normalizePath(metafile,        mustWork = FALSE)
metafile
metafile <- NULL
metafile         <- normalizePath(metafile,        mustWork = FALSE)
# Default Project Directories & Parameters
setup_project <- function(proj, species, contrasts,
parent_dir, gmt_dir, scripts_dir = NULL,
deseq2.override  = list(), heatmap.override = list(),
volcano.override = list(), pathway.override = list()) {
# ---- ğŸ› ï¸ Global Environment Configuration ----
options(future.globals.maxSize = 1e15)            # Increase future globals size for parallelization
options(Seurat.object.assay.version = "v5")       # Ensure Seurat uses v5 assay format
set.seed(1234)                                    # Set seed for reproducibility
# ---- ğŸ“Š Default Parameter Definition ----
# Default DESeq2 Parameters
default.deseq2 <- list(
contrasts     = c("Treatment-Control"),   # Vector of contrasts for DE analysis
design        = "Comparisons",            # DESeq2 design formula or column name
lfc.cutoff    = 0,                        # Log fold change cutoff for significance
padj.cutoff   = 0.1,                      # Adjusted p-value cutoff for significance
batch.correct = FALSE                     # Boolean, whether to apply batch correction
)
# Default Heatmap Parameters
default.heatmap <- list(
force.log        = FALSE,       # Force log transform (default FALSE i.e. auto detect)
col.ann          = NULL,        # Single/multiple columns from metadata_col for column annotation
row.ann          = NULL,        # Single/multiple columns from metadata_row for row annotation
col.gaps         = NULL,        # Single column from metadata_col to define column gaps in heatmap
row.gaps         = NULL,        # Single column from metadata_row to define row gaps in heatmap
col.cluster      = "all",       # Single column from metadata_col, "all", "alphabetical" for clustering columns
row.cluster      = "all",       # Single column from metadata_row, "all", "alphabetical" for clustering columns
palette          = "rdbu",      # Color palette for heatmap matrix ("rdbu" or "vrds")
ann.palette      = "discrete",  # Color palette for heatmap annotation ("discrete" or "sequential")
border.color     = NA,          # Color of heatmap cell borders (default NA i.e. no border)
show.expr.legend = TRUE,        # Show expression legend (set FALSE if annotations overlap)
title            = NA           # Title for heatmap (default NA i.e. no title)
)
# Default Volcano Parameters
default.volcano <- list(
lfc.cutoff   = 0.58,            # Log fold change cutoff for volcano plot
padj.cutoff  = 0.05,            # Adjusted p-value cutoff for volcano plot
color        = "vrds",          # Color palette for volcano plot ("vrds", etc.)
label.genes  = NULL             # Optional vector of genes to label on volcano plot
)
# Apply Overrides
deseq2.params  <- modifyList(default.deseq2,  deseq2.override)
heatmap.params <- modifyList(default.heatmap, heatmap.override)
volcano.params <- modifyList(default.volcano, volcano.override)
# ---- ğŸ“‚ Directory Structure Setup ----
proj_dir      <- file.path(parent_dir, proj)
# Bulk RNA-seq Directories
counts_dir    <- file.path(proj_dir, "counts")               # Directory containing count files
contrast_dir  <- file.path(proj_dir, contrasts)              # Directory to store results for each contrast
deseq2_dir    <- file.path(contrast_dir, "DEG_Analysis")     # Directory to store DESeq2 results
pathway_dir   <- file.path(contrast_dir, "Pathway_Analysis") # Directory to store Pathway analysis results
tf_dir        <- file.path(contrast_dir, "TF_Analysis")      # Directory to store TF analysis results
# Single-Cell RNA-seq Directories
diagnostics_dir        <- file.path(proj_dir, "04.Diagnostics")
demux_dir              <- file.path(proj_dir, "05.Demux")
raw_matrix_dir         <- file.path(proj_dir, "06.Matrix", "raw_feature_bc_matrix")
filt_matrix_dir        <- file.path(proj_dir, "06.Matrix", "filt_feature_bc_matrix")
hto_matrix_dir         <- file.path(proj_dir, "06.Matrix", "HTO_bc_matrix")
seurat_dir             <- file.path(proj_dir, "Seurat")
sc_deseq2_dir          <- file.path(proj_dir, "DESeq2")
pyscenic_dir           <- file.path(proj_dir, "pySCENIC")
scvelo_dir             <- file.path(proj_dir, "scVelo")
velocyto_dir           <- file.path(proj_dir, "velocyto")
cellphonedb_dir        <- file.path(proj_dir, "CellphoneDB")
cellchat_dir           <- file.path(proj_dir, "CellChat")
# ---- ğŸ§¬ Cell Marker and Gene Set Extraction ----
s_genes <- c()
g2m_genes <- c()
if (!is.null(scripts_dir)){
metafile               <- file.path(scripts_dir, "scRNASeq_Metadata", paste0(proj, "_Metadata.xlsx"))
markerfile             <- file.path(scripts_dir, "Cell_Type_Markers.xlsx")
cell.cycle.marker.file <- file.path(scripts_dir, "Cell_Cycle_Markers.xlsx")
# Extract Cell Cycle Genes (Human and Mouse)
if (file.exists(cell.cycle.marker.file)) {
cc_markers <- openxlsx::read.xlsx(cell.cycle.marker.file)
# Combine Human and Mouse genes for each phase
s_genes <- c(cc_markers$Human_Gene[cc_markers$Phase == "S"],
cc_markers$Mouse_Gene[cc_markers$Phase == "S"])
g2m_genes <- c(cc_markers$Human_Gene[cc_markers$Phase == "G2/M"],
cc_markers$Mouse_Gene[cc_markers$Phase == "G2/M"])
# Clean up potential NA/empty values resulting from unlist/subsetting
s_genes <- s_genes[!is.na(s_genes) & s_genes != ""]
g2m_genes <- g2m_genes[!is.na(g2m_genes) & g2m_genes != ""]
}
}
# ---- ğŸ“¦ Final Project Parameters Construction ----
proj.params <- c(
list(
# Project info
proj        = proj,
species     = species,
# Bulk RNA-seq directories
proj_dir    = normalizePath(proj_dir,     mustWork = FALSE),
counts_dir  = normalizePath(counts_dir,   mustWork = FALSE),
gmt_dir     = normalizePath(gmt_dir,      mustWork = FALSE),
contrast_dir= normalizePath(contrast_dir, mustWork = FALSE),
deseq2_dir  = normalizePath(deseq2_dir,   mustWork = FALSE),
pathway_dir = normalizePath(pathway_dir,  mustWork = FALSE),
tf_dir      = normalizePath(tf_dir,       mustWork = FALSE),
# Bulk RNA-seq parameters
contrasts   = contrasts,
deseq2      = deseq2.params,
heatmap     = heatmap.params,
volcano     = volcano.params,
# Single cell RNA-seq directories
diagnostics_dir  = normalizePath(diagnostics_dir, mustWork = FALSE),
demux_dir        = normalizePath(demux_dir,       mustWork = FALSE),
raw_matrix_dir   = normalizePath(raw_matrix_dir,  mustWork = FALSE),
filt_matrix_dir  = normalizePath(filt_matrix_dir, mustWork = FALSE),
hto_matrix_dir   = normalizePath(hto_matrix_dir,  mustWork = FALSE),
seurat_dir       = normalizePath(seurat_dir,      mustWork = FALSE),
sc_deseq2_dir    = normalizePath(sc_deseq2_dir,   mustWork = FALSE),
pyscenic_dir     = normalizePath(pyscenic_dir,    mustWork = FALSE),
scvelo_dir       = normalizePath(scvelo_dir,      mustWork = FALSE),
velocyto_dir     = normalizePath(velocyto_dir,    mustWork = FALSE),
cellphonedb_dir  = normalizePath(cellphonedb_dir, mustWork = FALSE),
cellchat_dir     = normalizePath(cellchat_dir,    mustWork = FALSE)
)
)
# Conditionally add single cell data only if scripts_dir is not NULL
if (!is.null(scripts_dir)) {
proj.params$metafile   <- normalizePath(metafile,   mustWork = FALSE)
proj.params$markerfile <- normalizePath(markerfile, mustWork = FALSE)
proj.params$cell_cycle <- list(S = s_genes, G2M = g2m_genes)
}
# ---- âš ï¸ Final Checks and Return ----
if (proj == "") warning("âš ï¸ Project name is empty")
if (species == "") warning("âš ï¸ Species is not set")
if (length(contrasts) == 0) warning("âš ï¸ No contrasts specified")
return(proj.params)
}
proj.params <- setup_project(proj             = proj,
species          = species,  #"Mus musculus", "Homo sapiens"
contrasts        = contrasts,
parent_dir       = parent_dir,
gmt_dir          = gmt_dir,
scripts_dir      = scripts_dir,
deseq2.override  = deseq2.override,
heatmap.override = heatmap.override,
volcano.override = volcano.override)
meta_data <- read.xlsx(file.path(proj.params$proj_dir, paste0(proj, "_Metadata.xlsx")))
trial <- TRUE
read_data <- read.xlsx(file.path(proj.params$proj_dir, paste0(proj, "_Raw_counts.xlsx")))
main_analysis(meta_data, read_data, proj.params, trial)
main_analysis(meta_data, read_data, proj.params, trial)
read_data <- read.xlsx(file.path(proj.params$proj_dir, paste0(proj, "_Raw_counts.xlsx")))
trial <- TRUE
main_analysis(meta_data, read_data, proj.params, trial)
# Run the Custom_Functions.R script
path1 <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Documents/GitHub/R-Scripts/Custom_Functions.R"
path2 <- "/hpc/home/kailasamms/projects/scRNASeq/Custom_Functions.R"
if (file.exists(path1)) {
source(path1)
} else if (file.exists(path2)) {
source(path2)
}
# Run the Custom_Functions.R script
path1 <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Documents/GitHub/R-Scripts/Custom_Functions.R"
path2 <- "/hpc/home/kailasamms/projects/scRNASeq/Custom_Functions.R"
if (file.exists(path1)) {
source(path1)
} else if (file.exists(path2)) {
source(path2)
}
parent_dir <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data"
gmt_dir    <- "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Documents/GSEA_genesets"
scripts_dir <- NULL
# parent_dir  <- "/hpc/home/kailasamms/scratch"
# gmt_dir     <- "/hpc/home/kailasamms/projects/GSEA_genesets"
# scripts_dir <- "/hpc/home/kailasamms/projects/scRNASeq"
# Define these 4 variables in project specific script
# contrasts <- c()
# deseq2.override <- list()
# heatmap.override <- list()
# volcano.override <- list()
proj.params <- setup_project(proj             = proj,
species          = species,  #"Mus musculus", "Homo sapiens"
contrasts        = contrasts,
parent_dir       = parent_dir,
gmt_dir          = gmt_dir,
scripts_dir      = scripts_dir,
deseq2.override  = deseq2.override,
heatmap.override = heatmap.override,
volcano.override = volcano.override)
meta_data <- read.xlsx(file.path(proj.params$proj_dir, paste0(proj, "_Metadata.xlsx")))
read_data <- read.xlsx(file.path(proj.params$proj_dir, paste0(proj, "_Raw_counts.xlsx")))
trial <- TRUE
main_analysis(meta_data, read_data, proj.params, trial)
trial <- FALSE
main_analysis(meta_data, read_data, proj.params, trial)
plot_venn(data, filename="a", output_dir = "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/")
data <- read.xlsx(file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/GSE132408/TET2KO-WT/DEGs.xlsx"), sheet = "DEGs+BulkRNASeq")
data <- read.xlsx(file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/GSE132408/TET2KO-WT/DEGs.xlsx"), sheet = "DEGs+BulkRNASeq")
View(data)
data <- data[,-1]
plot_venn(data, filename="a", output_dir = "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/")
# ALTERNATIVE: Use http://www.ehbio.com/test/venn/#/
plot_venn <- function(data, filename, output_dir){
# ---- âš™ï¸ Validate Input Parameters ----
validate_inputs(metadata = data, output_dir = output_dir, filename = filename)
# Validate column count (upto 4 columns)
if (ncol(data) < 1 || ncol(data) > 4) {
stop("`data` must have between 1 and 4 columns.")
}
# ---- ğŸ› ï¸ Configure Venn Diagram Settings ----
# Clean column names (replace non-standard characters with space for visualization)
colnames(data) <- stringr::str_replace_all(colnames(data), c("_" = " ", "\\." = " "))
# Set category position (cat.pos), label distance (cat.dist), font size (cex), and palette
# Settings are optimized based on the number of sets (columns)
if (ncol(data) == 4){
pos <- c(330, 15, 330, 15) # Quadrant positioning
dist <- c(0.27, 0.25, 0.15, 0.13)
cex = 2
palette1 <- c("#C8E7F5", "#00008C", "#F6D2E0", "#E75480")
} else if (ncol(data) == 3){
pos <- c(0, 0, 180)
dist <- c(0.1, 0.1, 0.1)
cex = 2
palette1 <- c("#C8E7F5", "#F6D2E0", "#db6d00")
} else if (ncol(data) == 2){
pos <- c(0, 0)
dist <- c(0.05, 0.05)
cex = 2.75
palette1 <- c("#C8E7F5", "#db6d00")
} else if (ncol(data) == 1){
pos <- c(0)
dist <- c(0.1)
cex = 2.75
palette1 <- c("#F6D2E0")
}
# Create a dataframe to store the wrapped column names for clean labels
annotation <- data.frame(Labels = stringr::str_wrap(colnames(data), width = 10))
# Convert the data frame to a named list (VennDiagram input format)
genes <- base::vector(mode = "list", length = ncol(data))
names(genes) <- annotation$Labels
for (i in 1:ncol(data)){
# Remove NA values to generate a clean list of genes for each set (label)
genes[[i]] <- data[!is.na(data[i]), i]
}
# ---- ğŸ“Š Generate Venn Diagram ----
file_name <- file.path(output_dir, paste0("Venn_Diagram_", filename, ".tiff"))
VennDiagram::venn.diagram(x = genes,
main = filename,
category.names = annotation$Labels,
filename = file_name,
output = TRUE,
scaled = FALSE, # Disable proportional scaling (can distort appearance)
imagetype = "tiff",
height = 11,
width = 11,
units = "in",
resolution = 600,
compression = "lzw",
margin = 0.3, # Amount of white space around Venn Diagram in grid units
# 1ï¸âƒ£ Line Formatting
lwd = 1.5,                 # line thickness
lty = 1,                   # line type
col = "black",             # line color
# 2ï¸âƒ£ Number Formatting
cex = cex,                 # font size (2 or 2.75)
fontface = "bold",         # font style
fontfamily = "sans",       # font type
# 3ï¸âƒ£ Main Title Formatting
main.cex = 2,              # font size
main.fontface = "bold",    # font style
main.fontfamily = "sans",  # font type
main.col = "black",        # font color
# 4ï¸âƒ£ Category Label Formatting
cat.cex = 2,               # font size
cat.fontface = "bold",     # font style
cat.fontfamily = "sans",   # font type
cat.col = palette1, #"black"
cat.pos = pos,
cat.dist = dist,
# 5ï¸âƒ£ Fill Colors
fill = palette1,
alpha = rep(0.5, ncol(data)),    # 50% transparency for fill color
ext.text = TRUE,           # Draw external text (labels)
#cat.default.pos = "outer",
disable.logging = TRUE)
# ---- ğŸ’¾ Save Overlapping Genes (Excel Output) ----
# 1ï¸âƒ£ Detect Unique Overlapping Genes Across All Combinations
overlap_list <- list()
detected_genes <- character(0) # Use character(0) for an empty character vector
# Iterate combinations from the largest (all datasets) down to the smallest (single datasets)
for (n in seq(from = ncol(data), to = 1, by = -1)){
# Generate all possible n-element combinations of set names
cmb <- utils::combn(x = names(genes), m = n)
for (col in 1:ncol(cmb)){
# Get the names of the datasets in the current combination
datasets <- cmb[,col]
# Calculate the intersection (overlapping genes) for the current combination
overlap <- Reduce(intersect, genes[datasets])
# Remove genes already detected in overlaps of previous (larger) comparisons.
# This ensures that each gene is counted only in the *largest* combination
# where it is present (i.e., unique to that specific overlap region).
overlap_unique <- base::setdiff(overlap, detected_genes)
# Add the newly found unique genes to the master list of detected genes
detected_genes <- c(detected_genes, overlap_unique)
# Collapse the set names into a clean label (e.g., "Set1.Set2.Set3")
names <- paste(datasets, collapse = ".")
# Store the vector of unique overlapping genes under the meaningful name
overlap_list[[names]] <- overlap_unique
}
}
# 2ï¸âƒ£ Format Results into a Data Frame for Saving
# Identify maximum number of genes present in any single unique overlap region
max_len = max(lengths(overlap_list))
# Create an empty data frame structure to hold all results
results = data.frame(matrix("", nrow = max_len, ncol = length(overlap_list)))
# Set row names to be generic gene numbers
rownames(results) <- paste0("Gene#", seq(max_len))
# Set column names to the meaningful set combination labels
colnames(results) <- names(overlap_list)
# Populate the dataframe (This loop was missing in your original paste)
for (i in 1:length(overlap_list)){
if (length(overlap_list[[i]]) > 0){
results[1:length(overlap_list[[i]]), i] <- overlap_list[[i]]
}
}
# 3ï¸âƒ£ Save Results to Excel Workbook (using openxlsx)
file_name <- file.path(output_dir, paste0("Overlap_", filename, ".xlsx"))
wb <- openxlsx::createWorkbook()
openxlsx::addWorksheet(wb, sheetName = "Output")
openxlsx::writeData(wb, sheet = "Output", x = results, rowNames = TRUE, keepNA = FALSE)
openxlsx::addWorksheet(wb, sheetName = "Input")
openxlsx::writeData(wb, sheet = "Input", x = data, rowNames = FALSE)
openxlsx::saveWorkbook(wb, file = file_name, overwrite = TRUE)
# ---- ğŸªµ Log Output ----
log_info(sample = "",
step = "plot_venn",
message = glue::glue("Venn plot saved successfully to : '{file_name}'."))
return(invisible(NULL))
}
plot_venn(data, filename="a", output_dir = "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/")
data <- read.xlsx(file.path("C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/Collaboration projects data/GSE132408/TET2KO-WT/DEGs.xlsx"), sheet = "DEGs+BulkRNASeq")
View(data)
data <- data[,-1]
plot_venn(data, filename="a", output_dir = "C:/Users/kailasamms/OneDrive - Cedars-Sinai Health System/Desktop/")
all.vars(~ Condition + Batch)
viridis::viridis(100)[100]
viridis::viridis(100)[1]
viridis::viridis(100)[50]
RColorBrewer::brewer.pal(8, "Set2")
fontsize <- 10
fontsize.row <- fontsize*1
fontsize.col <- fontsize*1
fontsize.number <- fontsize*0.8
angle.col <- 45       # column label angle
optimal_col.width <- fontsize+5
optimal_row.height <- fontsize+5
max_cols <- 6 * 72 / optimal_col.width
max_rows <- 8 * 72 / optimal_row.height
if (ncol(reordered) <= max_cols){
cell.width <- optimal_col.width
} else{
cell.width <- 6 * 72 / ncol(reordered)
}
reordered <- matrix(NA, nrow=100, ncol=15)
optimal_col.width <- fontsize+5
optimal_row.height <- fontsize+5
max_cols <- 6 * 72 / optimal_col.width
max_rows <- 8 * 72 / optimal_row.height
if (ncol(reordered) <= max_cols){
cell.width <- optimal_col.width
} else{
cell.width <- 6 * 72 / ncol(reordered)
}
if (nrow(reordered) <= max_rows){
cell.height <- optimal_row.height
} else{
cell.height <- 8 * 72 / nrow(reordered)
}
cell.width1 <- min(15, (6 * 72) / ncol(reordered))
cell.height1 <- min(15, (8 * 72) / nrow(reordered))
max_rows
(6 * 72) / ncol(reordered)
(8 * 72) / nrow(reordered)
max_rows
nrow(reordered)
6 * 72 / optimal_col.width
8 * 72 / optimal_row.height
ncol(reordered)
6 * 72 / ncol(reordered)
max_cols
6*72/10
6*72/20
6*72/30
6*72/28.8
metadata_row <- NULL
a <- "all"
a %in% c(colnames(metadata_row), "all", "alphabetical")
a <- "Condition"
a %in% c(colnames(metadata_row), "all", "alphabetical")
col_annotation <- NULL
gaps_col <- col_annotation %>%
dplyr::count(get(proj.params$heatmap$col.gaps)) %>%
dplyr::mutate(n = cumsum(n)) %>%
dplyr::pull(n)
library(dplyr)
gaps_col <- col_annotation %>%
dplyr::count(get(proj.params$heatmap$col.gaps)) %>%
dplyr::mutate(n = cumsum(n)) %>%
dplyr::pull(n)
a
a %in% colnames(col_annotation)
c(colnames(metadata_row), "all", "alphabetical")
col_list <- base::lapply(X = as.list(col_annotation), FUN = function(x) { as.character(x) %>% unique})
col_annotation
col_list <- base::lapply(X = as.list(col_annotation), FUN = function(x) { as.character(x) %>% unique})
as.list(NULL)
colnames(metadata_row) %>% na.omit()
